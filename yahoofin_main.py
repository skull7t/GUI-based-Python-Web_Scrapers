# -*- coding: utf-8 -*-

# Form implementation generated from reading ui file 'YahooFin_test.ui'
#
# Created by: PyQt5 UI code generator 5.15.2
#
# WARNING: Any manual changes made to this file will be lost when pyuic5 is
# run again.  Do not edit this file unless you know what you are doing.


from PyQt5 import QtCore, QtGui, QtWidgets
import requests
from bs4 import BeautifulSoup
from validate_email import validate_email
import validators
import csv
import re


class Ui_YahooWindow(object):
    #
    def handleLogin(self):
        global g_stckname
        g_stckname=self.stckname_txtbox.text()
        print(g_stckname)
        self.progressBar.setProperty("value", 20)
    #
        def fetching_data(self):
            url1='https://in.finance.yahoo.com/quote/'+g_stckname+'.NS?p='+g_stckname+'.NS&.tsrc=fin-srch'
            print(url1)
            self.progressBar.setProperty("value", 25)
            headers = {"User-Agent":'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/87.0.4280.88 Safari/537.36'}
            page=requests.get(url1,headers=headers)
            soup=BeautifulSoup(page.content,'html.parser')
            #stonk=input(str("entr stock"))
            #print(stonk)
            price=(soup.find_all('span',{'class':'Trsdu(0.3s) Fw(b) Fz(36px) Mb(-4px) D(ib)'})[0].text)
            title=(soup.find('h1',{'class':'D(ib) Fz(18px)'}).text)
            #openpr=soup.find('td', attrs={"data-reactid": "47"}) # 57+8*n
            close=(soup.find_all('span',attrs={"data-reactid": "42"})[0].text)
            pricesub=(soup.find_all('span',attrs={"data-reactid": "33"})[1].text)
            #pricesub=(soup.find_all('span',{'class':'Trsdu(0.3s) Fw(500) Pstart(10px) Fz(24px) C($negativeColor)'})[0].text)
            openpr=(soup.find_all('span',attrs={"data-reactid": "47"})[1].text)
            #volum=(soup.find_all('span',attrs={"data-reactid": "68"})[0].text)
            volum=(soup.find_all('td',{'class':'Ta(end) Fw(600) Lh(14px)'})[6].text)
            #daysr=(soup.find_all('td',attrs={"data-reactid": "59"})[0].text)
            daysr=(soup.find_all('td',{'class':'Ta(end) Fw(600) Lh(14px)'})[4].text)
            #weeksr=(soup.find_all('td',attrs={"data-reactid": "63"})[0].text)
            weeksr=(soup.find_all('td',{'class':'Ta(end) Fw(600) Lh(14px)'})[5].text)
            #title=(soup.find("h1")).get_text()
            print(price)
            print(title)
            print(close)
            print(openpr)
            print(daysr)
            print(weeksr)
            print(volum)
            print(pricesub)
            self.progressBar.setProperty("value", 30)
            store_price=price.replace(',','').replace('.00','')
            #converted_p = float(store_price)
            #print(converted_p)
            with open('GITHUB/YahooFin_System.csv', mode='w', newline="\n") as gvar:
               writer = csv.writer(gvar)
               writer.writerow([g_stckname])
               writer.writerow([store_price])
               writer.writerow([title])
               #writer.writerow([g_number])
               #writer.writerow([g_time])
            print("Stored System data in CSV")
            self.progressBar.setProperty("value", 40)
            self.title_label.setText(title)
            self.title_label.setAlignment(QtCore.Qt.AlignCenter)
            self.stockPrice_label.setText(price)
            self.stockPrice_label.setAlignment(QtCore.Qt.AlignCenter)
            self.openpr_label.setText(openpr)
            self.openpr_label.setAlignment(QtCore.Qt.AlignCenter)
            self.closepr_label.setText(close)
            self.closepr_label.setAlignment(QtCore.Qt.AlignCenter)
            self.daysr_label.setText(daysr)
            self.daysr_label.setAlignment(QtCore.Qt.AlignCenter)
            self.weeksr_label.setText(weeksr)
            self.weeksr_label.setAlignment(QtCore.Qt.AlignCenter)
            self.volumepr_label.setText(volum)
            self.volumepr_label.setAlignment(QtCore.Qt.AlignCenter)
            self.pricesub_label.setText(pricesub)
            self.pricesub_label.setAlignment(QtCore.Qt.AlignCenter)
        fetching_data(self)
        self.progressBar.setProperty("value", 50)
    #
    def handledata(self):
        #global g_stckname
        #g_stckname=self.stckname_txtbox.text()
        global g_dropprice
        g_dropprice=self.dropprice_txtbox.text()
        global g_mobile
        g_mobile=self.mobile_txtbox.text()
        global g_email
        g_email=self.email_txtbox.text()
        #print(g_stckname)
        print(g_dropprice)
        print(g_mobile)
        print(g_email)
        self.progressBar.setProperty("value", 60)
    #
    def store_csv(self):
        with open('GITHUB/YahooFin_User.csv', mode='w', newline="\n") as gvar:
               writer = csv.writer(gvar)
               writer.writerow([g_dropprice])
               writer.writerow([g_mobile])
               writer.writerow([g_email])
        print("stored User data in CSV")
    #    
    def email_validator(self):
        is_valid = validate_email(email_address=g_email, check_regex=True, check_mx=True, from_address='my@from.addr.ess', helo_host='my.host.name', smtp_timeout=10, dns_timeout=10, use_blacklist=True, debug=False)
        global em
        if is_valid==True:
             print("email is valid")
             global em
             em = 1
             self.invalidemail_label.setVisible(False)
             self.progressBar.setProperty("value", 60) 
        else:
            em = 0
            print("Invalid email")
            self.invalidemail_label.setVisible(True) 
     # 
    def number_validator(self):
        if re.match(r'[789]\d{9}$',g_mobile):   
            print("mobile no. is valid") 
            global nu
            nu = 1
            self.invalidmobile_label.setVisible(False) 
            self.progressBar.setProperty("value", 70)
        else:  
            nu = 0
            print("Invalid mobile no.")
            self.invalidmobile_label.setVisible(True)   
    #  
    def main2(self):
        if em==1 & nu==1:
            print ('Starting Program')
            self.progressBar.setProperty("value", 100)
            import yahoofin_RunCode
            exec(yahoofin_RunCode.py)
        else:
            print("all is invalid")
    #        
    def setupUi(self, YahooWindow):
        YahooWindow.setObjectName("YahooWindow")
        YahooWindow.resize(1128, 754)
        font = QtGui.QFont()
        font.setBold(False)
        font.setWeight(50)
        YahooWindow.setFont(font)
        icon = QtGui.QIcon()
        icon.addPixmap(QtGui.QPixmap("../../Downloads/71066a17509045338985457aa75f9137.png"), QtGui.QIcon.Normal, QtGui.QIcon.Off)
        YahooWindow.setWindowIcon(icon)
        self.centralwidget = QtWidgets.QWidget(YahooWindow)
        self.centralwidget.setObjectName("centralwidget")
        self.icon = QtWidgets.QLabel(self.centralwidget)
        self.icon.setGeometry(QtCore.QRect(470, 10, 211, 91))
        self.icon.setText("")
        self.icon.setPixmap(QtGui.QPixmap("../../Downloads/Yahoo_Finance_Logo_2013.png"))
        self.icon.setScaledContents(True)
        self.icon.setObjectName("icon")
        self.stckname_txtbox = QtWidgets.QLineEdit(self.centralwidget)
        self.stckname_txtbox.setGeometry(QtCore.QRect(380, 120, 371, 51))
        font = QtGui.QFont()
        font.setPointSize(10)
        font.setBold(True)
        font.setWeight(75)
        self.stckname_txtbox.setFont(font)
        self.stckname_txtbox.setObjectName("stckname_txtbox")
        self.label_stockname = QtWidgets.QLabel(self.centralwidget)
        self.label_stockname.setGeometry(QtCore.QRect(270, 130, 101, 31))
        self.label_stockname.setObjectName("label_stockname")
        self.stockPrice_label = QtWidgets.QLabel(self.centralwidget)
        self.stockPrice_label.setGeometry(QtCore.QRect(470, 260, 171, 31))
        font = QtGui.QFont()
        font.setFamily("MS Sans Serif")
        font.setPointSize(12)
        font.setBold(True)
        font.setWeight(75)
        self.stockPrice_label.setFont(font)
        self.stockPrice_label.setObjectName("stockPrice_label")
        self.search_button = QtWidgets.QPushButton(self.centralwidget)
        self.search_button.setGeometry(QtCore.QRect(520, 180, 93, 28))
        self.search_button.setCursor(QtGui.QCursor(QtCore.Qt.PointingHandCursor))
        self.search_button.setObjectName("search_button")
        self.search_button.clicked.connect(self.handleLogin)
        self.open_label = QtWidgets.QLabel(self.centralwidget)
        self.open_label.setGeometry(QtCore.QRect(220, 310, 61, 21))
        self.open_label.setObjectName("open_label")
        self.daysrange_label = QtWidgets.QLabel(self.centralwidget)
        self.daysrange_label.setGeometry(QtCore.QRect(500, 310, 131, 21))
        self.daysrange_label.setObjectName("daysrange_label")
        self.weekrange_label = QtWidgets.QLabel(self.centralwidget)
        self.weekrange_label.setGeometry(QtCore.QRect(700, 310, 121, 21))
        self.weekrange_label.setObjectName("weekrange_label")
        self.close_label = QtWidgets.QLabel(self.centralwidget)
        self.close_label.setGeometry(QtCore.QRect(370, 310, 61, 21))
        self.close_label.setObjectName("close_label")
        self.dropprice_txtbox = QtWidgets.QLineEdit(self.centralwidget)
        self.dropprice_txtbox.setGeometry(QtCore.QRect(510, 440, 131, 41))
        font = QtGui.QFont()
        font.setFamily("MS Sans Serif")
        font.setPointSize(9)
        font.setBold(True)
        font.setWeight(75)
        self.dropprice_txtbox.setFont(font)
        self.dropprice_txtbox.setObjectName("dropprice_txtbox")
        self.setprice_label = QtWidgets.QLabel(self.centralwidget)
        self.setprice_label.setGeometry(QtCore.QRect(480, 400, 191, 31))
        self.setprice_label.setObjectName("setprice_label")
        self.dropprice_label = QtWidgets.QLabel(self.centralwidget)
        self.dropprice_label.setGeometry(QtCore.QRect(370, 440, 131, 31))
        self.dropprice_label.setObjectName("dropprice_label")
        self.mobile_txtbox = QtWidgets.QLineEdit(self.centralwidget)
        self.mobile_txtbox.setGeometry(QtCore.QRect(480, 570, 181, 31))
        font = QtGui.QFont()
        font.setFamily("MS Sans Serif")
        font.setBold(True)
        font.setWeight(75)
        self.mobile_txtbox.setFont(font)
        self.mobile_txtbox.setObjectName("mobile_txtbox")
        self.mobile_label = QtWidgets.QLabel(self.centralwidget)
        self.mobile_label.setGeometry(QtCore.QRect(380, 570, 91, 31))
        self.mobile_label.setObjectName("mobile_label")
        self.email_txtbox = QtWidgets.QLineEdit(self.centralwidget)
        self.email_txtbox.setGeometry(QtCore.QRect(480, 620, 181, 31))
        font = QtGui.QFont()
        font.setFamily("MS Sans Serif")
        font.setBold(True)
        font.setWeight(75)
        self.email_txtbox.setFont(font)
        self.email_txtbox.setObjectName("email_txtbox")
        self.email_label = QtWidgets.QLabel(self.centralwidget)
        self.email_label.setGeometry(QtCore.QRect(380, 620, 81, 31))
        self.email_label.setObjectName("email_label")
        self.Submit_button = QtWidgets.QPushButton(self.centralwidget)
        self.Submit_button.setGeometry(QtCore.QRect(520, 670, 93, 28))
        self.Submit_button.setCursor(QtGui.QCursor(QtCore.Qt.PointingHandCursor))
        self.Submit_button.setObjectName("Submit_button")
        self.Submit_button.clicked.connect(self.handledata)
        self.Submit_button.clicked.connect(self.email_validator)
        self.Submit_button.clicked.connect(self.number_validator)
        self.Submit_button.clicked.connect(self.store_csv)
        self.Submit_button.clicked.connect(self.main2)
        self.setalert_label = QtWidgets.QLabel(self.centralwidget)
        self.setalert_label.setGeometry(QtCore.QRect(480, 530, 191, 31))
        self.setalert_label.setObjectName("setalert_label")
        self.invalidmobile_label = QtWidgets.QLabel(self.centralwidget)
        self.invalidmobile_label.setGeometry(QtCore.QRect(680, 580, 131, 16))
        self.invalidmobile_label.setObjectName("invalidmobile_label")
        self.invalidmobile_label.setVisible(False) 
        self.invalidemail_label = QtWidgets.QLabel(self.centralwidget)
        self.invalidemail_label.setGeometry(QtCore.QRect(680, 630, 131, 16))
        self.invalidemail_label.setObjectName("invalidemail_label")
        self.invalidemail_label.setVisible(False) 
        self.volume_label = QtWidgets.QLabel(self.centralwidget)
        self.volume_label.setGeometry(QtCore.QRect(880, 310, 121, 21))
        self.volume_label.setObjectName("volume_label")
        self.volumepr_label = QtWidgets.QLabel(self.centralwidget)
        self.volumepr_label.setGeometry(QtCore.QRect(860, 340, 151, 20))
        font = QtGui.QFont()
        font.setPointSize(10)
        self.volumepr_label.setFont(font)
        self.volumepr_label.setObjectName("volumepr_label")
        self.daysr_label = QtWidgets.QLabel(self.centralwidget)
        self.daysr_label.setGeometry(QtCore.QRect(480, 340, 161, 20))
        font = QtGui.QFont()
        font.setPointSize(10)
        self.daysr_label.setFont(font)
        self.daysr_label.setObjectName("daysr_label")
        self.closepr_label = QtWidgets.QLabel(self.centralwidget)
        self.closepr_label.setGeometry(QtCore.QRect(360, 340, 91, 20))
        font = QtGui.QFont()
        font.setPointSize(10)
        self.closepr_label.setFont(font)
        self.closepr_label.setObjectName("closepr_label")
        self.openpr_label = QtWidgets.QLabel(self.centralwidget)
        self.openpr_label.setGeometry(QtCore.QRect(210, 340, 91, 20))
        font = QtGui.QFont()
        font.setPointSize(10)
        self.openpr_label.setFont(font)
        self.openpr_label.setObjectName("openpr_label")
        self.weeksr_label = QtWidgets.QLabel(self.centralwidget)
        self.weeksr_label.setGeometry(QtCore.QRect(690, 340, 141, 20))
        font = QtGui.QFont()
        font.setPointSize(10)
        self.weeksr_label.setFont(font)
        self.weeksr_label.setObjectName("weeksr_label")
        self.title_label = QtWidgets.QLabel(self.centralwidget)
        self.title_label.setGeometry(QtCore.QRect(190, 220, 741, 31))
        font = QtGui.QFont()
        font.setFamily("MS Sans Serif")
        font.setPointSize(15)
        font.setBold(True)
        font.setWeight(75)
        self.title_label.setFont(font)
        self.title_label.setObjectName("title_label")
        self.progressBar = QtWidgets.QProgressBar(self.centralwidget)
        self.progressBar.setGeometry(QtCore.QRect(680, 670, 118, 23))
        self.progressBar.setProperty("value", 10)
        self.progressBar.setObjectName("progressBar")
        self.pricesub_label = QtWidgets.QLabel(self.centralwidget)
        self.pricesub_label.setGeometry(QtCore.QRect(640, 270, 171, 20))
        font = QtGui.QFont()
        font.setPointSize(10)
        self.pricesub_label.setFont(font)
        self.pricesub_label.setObjectName("pricesub_label")
        YahooWindow.setCentralWidget(self.centralwidget)
        self.menubar = QtWidgets.QMenuBar(YahooWindow)
        self.menubar.setGeometry(QtCore.QRect(0, 0, 1128, 26))
        self.menubar.setObjectName("menubar")
        YahooWindow.setMenuBar(self.menubar)
        self.statusbar = QtWidgets.QStatusBar(YahooWindow)
        self.statusbar.setObjectName("statusbar")
        YahooWindow.setStatusBar(self.statusbar)

        self.retranslateUi(YahooWindow)
        QtCore.QMetaObject.connectSlotsByName(YahooWindow)

    def retranslateUi(self, YahooWindow):
        _translate = QtCore.QCoreApplication.translate
        YahooWindow.setWindowTitle(_translate("YahooWindow", "YahooFinance_Scraper"))
        self.label_stockname.setText(_translate("YahooWindow", "<html><head/><body><p><span style=\" font-size:9pt; font-weight:600;\">STOCK NAME</span></p></body></html>"))
        self.stockPrice_label.setText(_translate("YahooWindow", "<html><head/><body><p align=\"center\"><span style=\" font-size:16pt;\">00.00</span></p></body></html>"))
        self.search_button.setText(_translate("YahooWindow", "Search"))
        self.open_label.setText(_translate("YahooWindow", "<html><head/><body><p align=\"center\"><span style=\" font-size:10pt; font-weight:600; color:#5500ff;\">OPEN</span></p></body></html>"))
        self.daysrange_label.setText(_translate("YahooWindow", "<html><head/><body><p align=\"center\"><span style=\" font-size:10pt; font-weight:600; color:#5500ff;\">DAY\'S RANGE</span></p></body></html>"))
        self.weekrange_label.setText(_translate("YahooWindow", "<html><head/><body><p align=\"center\"><span style=\" font-size:10pt; font-weight:600; color:#5500ff;\">52w RANGE</span></p></body></html>"))
        self.close_label.setText(_translate("YahooWindow", "<html><head/><body><p align=\"center\"><span style=\" font-size:10pt; font-weight:600; color:#5500ff;\">CLOSE</span></p></body></html>"))
        self.setprice_label.setText(_translate("YahooWindow", "<html><head/><body><p align=\"center\"><span style=\" font-size:16pt; font-weight:600;\">SET PRICE</span></p></body></html>"))
        self.dropprice_label.setText(_translate("YahooWindow", "<html><head/><body><p><span style=\" font-size:9pt; font-weight:600;\">SET ALERT PRICE</span></p></body></html>"))
        self.mobile_label.setText(_translate("YahooWindow", "<html><head/><body><p><span style=\" font-size:9pt; font-weight:600;\">MOBILE NO. </span></p></body></html>"))
        self.email_label.setText(_translate("YahooWindow", "<html><head/><body><p><span style=\" font-size:9pt; font-weight:600;\">EMAIL ID</span></p></body></html>"))
        self.Submit_button.setText(_translate("YahooWindow", "SET ALERT"))
        self.setalert_label.setText(_translate("YahooWindow", "<html><head/><body><p align=\"center\"><span style=\" font-size:16pt; font-weight:600;\">SET ALERT</span></p></body></html>"))
        self.invalidmobile_label.setText(_translate("YahooWindow", "<html><head/><body><p><span style=\" font-size:9pt; font-weight:600; color:#ff0000;\">Invalid Mobile No.</span></p></body></html>"))
        self.invalidemail_label.setText(_translate("YahooWindow", "<html><head/><body><p><span style=\" font-size:9pt; font-weight:600; color:#ff0000;\">Invalid Email ID</span></p></body></html>"))
        self.volume_label.setText(_translate("YahooWindow", "<html><head/><body><p align=\"center\"><span style=\" font-size:10pt; font-weight:600; color:#5500ff;\">VOLUME</span></p></body></html>"))
        self.volumepr_label.setText(_translate("YahooWindow", "<html><head/><body><p align=\"center\">00.00</p></body></html>"))
        self.daysr_label.setText(_translate("YahooWindow", "<html><head/><body><p align=\"center\">00.00</p></body></html>"))
        self.closepr_label.setText(_translate("YahooWindow", "<html><head/><body><p align=\"center\">00.00</p></body></html>"))
        self.openpr_label.setText(_translate("YahooWindow", "<html><head/><body><p align=\"center\">00.00</p></body></html>"))
        self.weeksr_label.setText(_translate("YahooWindow", "<html><head/><body><p align=\"center\">00.00</p></body></html>"))
        self.title_label.setText(_translate("YahooWindow", "<html><head/><body><p align=\"center\">STOCK NAME</p></body></html>"))
        self.pricesub_label.setText(_translate("YahooWindow", "00.00"))


if __name__ == "__main__":
    import sys
    app = QtWidgets.QApplication(sys.argv)
    YahooWindow = QtWidgets.QMainWindow()
    ui = Ui_YahooWindow()
    ui.setupUi(YahooWindow)
    YahooWindow.show()
    sys.exit(app.exec_())
